"use strict";(self.webpackChunkiota_wiki=self.webpackChunkiota_wiki||[]).push([[86370],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),p=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(a),h=n,d=u["".concat(l,".").concat(h)]||u[h]||m[h]||s;return a?r.createElement(d,o(o({ref:t},c),{},{components:a})):r.createElement(d,o({ref:t},c))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=a.length,o=new Array(s);o[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,o[1]=i;for(var p=2;p<s;p++)o[p]=a[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},30920:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var r=a(87462),n=(a(67294),a(3905));const s={keywords:["proxies","sandbox","wasm","value proxies","container proxies","array proxies","map proxies","explanation"],description:"As there is no way for the Wasm code to access any memory outside its own memory space, the WasmLib interface provides a number of proxies to make accessing data within the ISC sandbox as seamless as possible.",image:"/img/wasm_vm/Proxies.png"},o="Data Access Proxies",i={unversionedId:"guide/wasm_vm/proxies",id:"guide/wasm_vm/proxies",title:"Data Access Proxies",description:"As there is no way for the Wasm code to access any memory outside its own memory space, the WasmLib interface provides a number of proxies to make accessing data within the ISC sandbox as seamless as possible.",source:"@site/next/external/wasp/documentation/docs/guide/wasm_vm/proxies.mdx",sourceDirName:"guide/wasm_vm",slug:"/guide/wasm_vm/proxies",permalink:"/next/smart-contracts/guide/wasm_vm/proxies",draft:!1,editUrl:"https://github.com/iotaledger/wasp/edit/develop/documentation/next/external/wasp/documentation/docs/guide/wasm_vm/proxies.mdx",tags:[],version:"current",frontMatter:{keywords:["proxies","sandbox","wasm","value proxies","container proxies","array proxies","map proxies","explanation"],description:"As there is no way for the Wasm code to access any memory outside its own memory space, the WasmLib interface provides a number of proxies to make accessing data within the ISC sandbox as seamless as possible.",image:"/img/wasm_vm/Proxies.png"},sidebar:"tutorialSidebar",previous:{title:"Using the Schema Tool",permalink:"/next/smart-contracts/guide/wasm_vm/usage"},next:{title:"WasmLib Data Types",permalink:"/next/smart-contracts/guide/wasm_vm/types"}},l={},p=[{value:"Value Proxies",id:"value-proxies",level:2},{value:"Container Proxies",id:"container-proxies",level:2},{value:"Map Proxies",id:"map-proxies",level:3},{value:"Array Proxies",id:"array-proxies",level:3},{value:"Example That Shows the Use of Proxies in WasmLib",id:"example-that-shows-the-use-of-proxies-in-wasmlib",level:2}],c={toc:p};function m(e){let{components:t,...s}=e;return(0,n.kt)("wrapper",(0,r.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"data-access-proxies"},"Data Access Proxies"),(0,n.kt)("p",null,"As we cannot call the ISC sandbox functions directly, we need some library to access the\nsandbox functionality. There is no way for the Wasm code to access any memory outside its\nwn memory space. Therefore, any data that is governed by the ISC sandbox has to be copied\nin and out of that memory space through well-defined protected channels in the Wasm\nruntime system."),(0,n.kt)("p",null,"To make this whole process as seamless as possible the WasmLib interface uses so-called\n",(0,n.kt)("inlineCode",{parentName:"p"},"proxies"),". Proxies are objects that can perform the underlying data transfers between the\nseparate systems. Proxies are like data references in that regard, they refer to the\nactual objects or values stored on the ISC host, and know how to manipulate them. Proxies\nprovide a consistent interface to access the smart contract data."),(0,n.kt)("p",null,"At the lowest level data is stored on the ISC host in maps that take a byte string as key\nand a byte string as value. There are 3 predefined maps from the viewpoint of WasmLib.\nThey are:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"the ",(0,n.kt)("a",{parentName:"li",href:"/next/smart-contracts/guide/wasm_vm/state"},"State")," map, which holds all state storage values"),(0,n.kt)("li",{parentName:"ul"},"the ",(0,n.kt)("a",{parentName:"li",href:"/next/smart-contracts/guide/wasm_vm/params"},"Params")," map, which holds the current function call's parameter values"),(0,n.kt)("li",{parentName:"ul"},"the ",(0,n.kt)("a",{parentName:"li",href:"/next/smart-contracts/guide/wasm_vm/results"},"Results")," map, which returns the function call's result values")),(0,n.kt)("p",null,"The ",(0,n.kt)("a",{parentName:"p",href:"/next/smart-contracts/guide/wasm_vm/usage"},"Schema Tool")," is able to build a more complex, JSON-like data structure\non top of these maps, but in the end it all translates to simple key/value access on the\nunderlying map."),(0,n.kt)("h2",{id:"value-proxies"},"Value Proxies"),(0,n.kt)("p",null,"The most basic proxies are value proxies. They refer to a single value instance of a\npredetermined data type. Value proxies refer to their values through a proxy object that\ndefines the underlying map and the key that uniquely defines the value's location in that\nmap. Value proxies can manipulate the value they refer to and will perform appropriate\ntype conversion of the byte string that makes up the stored value."),(0,n.kt)("p",null,"The ",(0,n.kt)("a",{parentName:"p",href:"/next/smart-contracts/guide/wasm_vm/usage"},"Schema Tool")," will make sure that the type-safe code that it generates\nalways uses the appropriate proxy type."),(0,n.kt)("h2",{id:"container-proxies"},"Container Proxies"),(0,n.kt)("p",null,"Container proxies create a virtual nesting system on the underlying map. Just as with\nvalue proxies, they refer to their virtual container through a proxy object that defines\nthe underlying map and the key that uniquely defines the virtual container in that map.\nContrary to value proxies these virtual containers need no storage."),(0,n.kt)("p",null,"The ",(0,n.kt)("a",{parentName:"p",href:"/next/smart-contracts/guide/wasm_vm/usage"},"Schema Tool")," automatically generates code that allows the user to navigate\nthe virtual path through the nested virtual containers. In the end this path leads to\naccess to value proxies of all values that are located in that virtual container."),(0,n.kt)("p",null,"To keep things as simple and understandable we imitate the way JSON and YAML nest\ncontainers. That means there are only two different kinds of container proxies: array\nproxies and map proxies. Because we allow nesting of containers, these are enough to be\nable to define surprisingly complex data structures."),(0,n.kt)("h3",{id:"map-proxies"},"Map Proxies"),(0,n.kt)("p",null,"A map is a key/value store where the key is one of our supported value types. Within a\nmap, keys are always of the same data type. The root maps (",(0,n.kt)("a",{parentName:"p",href:"/next/smart-contracts/guide/wasm_vm/state"},"State"),",\n",(0,n.kt)("a",{parentName:"p",href:"/next/smart-contracts/guide/wasm_vm/params"},"Params"),", and ",(0,n.kt)("a",{parentName:"p",href:"/next/smart-contracts/guide/wasm_vm/results"},"Results"),") can store elements of any type, but\ntheir keys are limited to human-readable strings. This is because these keys needs to be\ndefined in the schema definition file. Virtual maps, which are nested under a root map,\ncan hold values of a single associated data type, which can be one of our supported value\ntypes, a user-defined data type, or a virtual container object (map or array)."),(0,n.kt)("h3",{id:"array-proxies"},"Array Proxies"),(0,n.kt)("p",null,"An array can be seen as a special kind of map. Its key is an Int32 value that has the\nproperty that keys always form a sequence from 0 to N-1 for an array with N elements.\nArrays always store elements of a single associated data type, which can be one of our\nsupported value types, a user-defined type, or a virtual container object (map or array)."),(0,n.kt)("h2",{id:"example-that-shows-the-use-of-proxies-in-wasmlib"},"Example That Shows the Use of Proxies in WasmLib"),(0,n.kt)("p",null,(0,n.kt)("a",{target:"_blank",href:a(18025).Z},(0,n.kt)("img",{alt:"Proxies in WasmLib",src:a(9825).Z,width:"862",height:"686"}))),(0,n.kt)("p",null,"In this example we have a single map in the ISC state storage that contains a number of\nkey/value combinations (Key 1 through Key 4). One of them (Key 4) refers to an array,\nwhich in turn contains indexed values stored at indexes 0 through N."),(0,n.kt)("p",null,"Notice how the WasmLib proxies mirror these exactly. There is a container proxy for each\ncontainer, and a value proxy for each value stored."),(0,n.kt)("p",null,"Also note that despite the one-to-one correspondence in the example it is not necessary\nfor a smart contract function to define a proxy for every value or container in the ISC\nstate storage. In practice a function will only use proxies to data that it actually\nneeds to access."),(0,n.kt)("p",null,"In the next section we will go into more detail about the supported\n",(0,n.kt)("a",{parentName:"p",href:"/next/smart-contracts/guide/wasm_vm/types"},"WasmLib Data Types"),"."))}m.isMDXComponent=!0},18025:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/files/Proxies-2066daf7b371183fb722d7583cb6b6bb.png"},9825:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/Proxies-2066daf7b371183fb722d7583cb6b6bb.png"}}]);